ROSTemplateFormatVersion: '2015-09-01'
Description: According the existing ECS instance, clone a set of ECS instanes with
  the same configuration(InstanceType, ImageId, InternetChargeType, InternetMaxBandwidthIn,
  InternetMaxBandwidthOut, system disk, data disk configurations, VPC properties).
  The user needs to specify SourceInstanceId.
Parameters:
  SourceInstanceId:
    Type: String
    Label: Source Instance Id
    Description: The source ECS instance id to be cloned
  NewImageId:
    Type: String
    Label: ECS Image Id
    Description: Image Id, represents the image resource to startup one ECS instance,
      <a href='#/product/cn-beijing/list/imageList' target='_blank'>View image resources</a>
    Default: ubuntu_14
  InstanceName:
    Type: String
    Label: ECS Instance Name
    Description: '[2, 128] alphanumeric letters, underline, dot or hyphen'
    ConstraintDescription: '[2, 128] characters, consists of uppercase letter, lowercase
      letter, number or special characters.'
    Default: ecsInstance
    MinLength: 2
    MaxLength: 128
  MaxAmount:
    Type: Number
    Label: The Maximum Of ECS Instances
    Description: The maximum of ECS instances, must be greater than or equal to the
      minimum.
    ConstraintDescription: An integer within [1, 100]
    Default: 1
    MinValue: 1
    MaxValue: 100
  MinAmount:
    Type: Number
    Label: The Minimum Of ECS Instances
    Description: The minimum of ECS instances, must be less than or equal to the maximum.
    ConstraintDescription: An integer within [1, 100]
    Default: 1
    MinValue: 1
    MaxValue: 100
  Password:
    Type: String
    Label: ECS Instance Password
    Description: The login password of ECS instance
    ConstraintDescription: '[8, 30] characters, consists of uppercase letter, lowercase
      letter, number or special characters.'
    AllowedPattern: '[a-zA-Z][a-zA-Z0-9]*'
    MinLength: 8
    MaxLength: 30
    NoEcho: true
    Confirm: true
  LoadBalancerIdToAttach:
    Type: String
    Label: Load Balancer Id To Attach
    Description: The existing SLB ID
  BackendServerWeight:
    Type: String
    Label: Backend Server Weight
    Description: The weight of backend server added to SLB
    Default: 100
Resources:
  ecsInstanceGroup:
    Type: ALIYUN::ECS::InstanceGroupClone
    Properties:
      ImageId:
        Ref: NewImageId
      BackendServerWeight:
        Ref: BackendServerWeight
      InstanceName:
        Ref: InstanceName
      LoadBalancerIdToAttach:
        Ref: LoadBalancerIdToAttach
      MaxAmount:
        Ref: MaxAmount
      MinAmount:
        Ref: MinAmount
      Password:
        Ref: Password
      SourceInstanceId:
        Ref: SourceInstanceId
Outputs:
  InstanceIds:
    Description: The instance id list of created ecs instance
    Value:
      Fn::GetAtt:
      - ecsInstanceGroup
      - InstanceIds
  PublicIps:
    Description: Public IP address list of created ecs instance.
    Value:
      Fn::GetAtt:
      - ecsInstanceGroup
      - PublicIps
  ZoneIds:
    Description: Zone id of created instance.
    Value:
      Fn::GetAtt:
      - ecsInstanceGroup
      - ZoneIds
