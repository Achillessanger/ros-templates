ROSTemplateFormatVersion: '2015-09-01'
Description:
  en: Create Vpc type of Slb.
  zh-cn: 创建Vpc类型的Slb。
Parameters:
  VpcCidrBlock:
    Type: String
    Label:
      en: VPC CIDR Block
      zh-cn: 专有网络网段
    Description:
      en: 'The IP address range of the VPC in the CIDR block form. You can use the
        following IP address ranges and their subnets: 10.0.0.0/8 172.16.0.0/12  192.168.0.0/16'
      zh-cn: 专有网络的网段，可选值：10.0.0.0/8，172.16.0.0/12，192.168.0.0/16。
    Default: 192.168.0.0/16
    AllowedValues:
    - 192.168.0.0/16
    - 172.16.0.0/12
    - 10.0.0.0/8
  VSwitchZoneId:
    Type: String
    Label:
      en: Zone ID
      zh-cn: 可用区ID
    Description:
      en: The available zone ID, you should confirm the zone support SLB or not.
      zh-cn: 可用区ID，需确认所选可用区下是否支持SLB等资源。
    AssociationProperty: ALIYUN::ECS::Instance::ZoneId
  VSwitchCidrBlock:
    Type: String
    Label:
      zh-cn: 交换机网段
      en: VSwitch CIDR Block
    Description:
      zh-cn: 必须是所属专有网络的子网段，并且没有被其他交换机占用。
      en: Must be a sub-network segment of the proprietary network and is not occupied
        by other VSwitches.
    Default: 192.168.0.0/24
  LoadBalancerSpec:
    Type: String
    Label:
      en: Specification
      zh-cn: 规格
    Description:
      zh-cn: 负载均衡规格，<a href='https://help.aliyun.com/document_detail/85939.html' target='_blank'><font
        color='blue'><b>规格详情</b></font></a>。
      en: Load balancing specification, <a href='https://help.aliyun.com/document_detail/85939.html'
        target='_blank'><font color='blue'><b>Slb spec detail</b></font>.</a>
    Default: slb.s1.small
  LoadBalancerAddressType:
    Type: String
    Label:
      en: Address Type
      zh-cn: 地址类型
    Description:
      zh-cn: '负载均衡器的地址类型。intranet: 内网， internet: 外网。'
      en: The address type of the load balancer. "intranet" or "internet".
    Default: intranet
Resources:
  EcsVpc:
    Type: ALIYUN::ECS::VPC
    Properties:
      VpcName:
        Fn::Join:
        - '-'
        - - StackId
          - Ref: ALIYUN::StackId
      CidrBlock:
        Ref: VpcCidrBlock
    Metadata:
      ALIYUN::ROS::Designer:
        id: 47344e64-a958-4b6b-8d48-f78de66b984c
  EcsVSwitch:
    Type: ALIYUN::ECS::VSwitch
    Properties:
      ZoneId:
        Ref: VSwitchZoneId
      VpcId:
        Ref: EcsVpc
      VSwitchName:
        Fn::Join:
        - '-'
        - - StackId
          - Ref: ALIYUN::StackId
      CidrBlock:
        Ref: VSwitchCidrBlock
    Metadata:
      ALIYUN::ROS::Designer:
        id: 64ca78f1-6a70-46cd-8c09-bcf7b1305bde
  SlbLoadBalancer:
    Type: ALIYUN::SLB::LoadBalancer
    Properties:
      VpcId:
        Ref: EcsVpc
      VSwitchId:
        Ref: EcsVSwitch
      LoadBalancerName:
        Fn::Join:
        - '-'
        - - StackId
          - Ref: ALIYUN::StackId
      PayType: PayOnDemand
      AddressType:
        Ref: LoadBalancerAddressType
      LoadBalancerSpec:
        Ref: LoadBalancerSpec
    DependsOn: EcsVSwitch
    Metadata:
      ALIYUN::ROS::Designer:
        id: 55709b9f-d38e-45de-9961-7c65252ce471
Outputs:
  SlbLoadBalancerId:
    Description:
      en: The ID of load balance created.
      zh-cn: 创建的负载均衡ID。
    Value:
      Fn::GetAtt:
      - SlbLoadBalancer
      - LoadBalancerId
Metadata:
  ALIYUN::ROS::Interface:
    ParameterGroups:
    - Parameters:
      - VpcCidrBlock
      - VSwitchZoneId
      - VSwitchCidrBlock
      Label:
        default:
          en: VPC
          zh-cn: 专有网络
    - Parameters:
      - LoadBalancerSpec
      Label:
        default:
          en: SLB
          zh-cn: 负载均衡
    TemplateTags:
    - acs:example:网络:创建VPC类型的SLB
  ALIYUN::ROS::Designer:
    47344e64-a958-4b6b-8d48-f78de66b984c:
      size:
        width: 194
        height: 221
      position:
        x: 200
        y: 59
      z: 0
      embeds:
      - 64ca78f1-6a70-46cd-8c09-bcf7b1305bde
    64ca78f1-6a70-46cd-8c09-bcf7b1305bde:
      size:
        width: 144
        height: 178
      position:
        x: 223
        y: 83
      z: 1
      embeds:
      - 55709b9f-d38e-45de-9961-7c65252ce471
    55709b9f-d38e-45de-9961-7c65252ce471:
      size:
        width: 60
        height: 60
      position:
        x: 268
        y: 143
      z: 2
