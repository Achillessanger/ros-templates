ROSTemplateFormatVersion: '2015-09-01'
Description: Create a sub account, enable the console login, and create access key.
Parameters:
  UserName:
    Type: String
    Label:
      en: Account Name
      zh-cn: 账号名称
    Description:
      en: The name of sub account, [1, 64]Consist of lowercase letter, number, '@',
        '.', '_' or '-'.
      zh-cn: 用户名， [1, 64]英文或中文字符，必须以字母，可以包含数字、下划线或“.”、“-”。
    ConstraintDescription:
      en: '[1, 64]. Consist of lowercase letter, number, ''@'', ''.'', ''_'' or ''-'''
      zh-cn: '[1, 64]. 由小写字母、数字、''@''、''.''、''_'' 或 ''-'' 组成'
    Default: DefaultUserTest
    AllowedPattern: ^[a-zA-Z0-9.@-_]+$
  Password:
    Type: String
    Label:
      en: Account Password
      zh-cn: 账户登录密码
    Description:
      en: The login password of sub account. The password is a string of 8 to 30 characters
        and must contain uppercase/lowercase letters, numbers.
      zh-cn: 账户登录密码。密码是一个8到30个字符的字符串，必须包含大写/小写字母和数字。
    ConstraintDescription:
      en: The password is a string of 8 to 30 characters and must contain uppercase/lowercase
        letters, numbers.
      zh-cn: 密码是8到30个字符的字符串，必须包含大写/小写字母、数字。
    AllowedPattern: '[a-zA-Z0-9-\(\)\`\~\!@\#\$%\^&\*-+=\|\{\}\[\]\:\;\‘\,\.\?\/]*'
    MinLength: '8'
    MaxLength: '30'
    NoEcho: true
Resources:
  RamUser:
    Type: ALIYUN::RAM::User
    Properties:
      LoginProfile:
        Password:
          Ref: Password
        PasswordResetRequired: false
      UserName:
        Ref: UserName
  RamAK:
    Type: ALIYUN::RAM::AccessKey
    Properties:
      UserName:
        Fn::GetAtt:
        - RamUser
        - UserName
Outputs:
  ak_id:
    Value:
      Fn::GetAtt:
      - RamAK
      - AccessKeyId
  user_id:
    Value:
      Fn::GetAtt:
      - RamUser
      - UserId
Metadata:
  ALIYUN::ROS::Interface:
    ParameterGroups:
    - Parameters:
      - UserName
      - Password
      Label:
        default: RAM
    TemplateTags:
    - acs:example:安全:创建子帐号并生成ak及开启控制台登录
