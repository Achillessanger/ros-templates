ROSTemplateFormatVersion: "2015-09-01"
Description: Configure the AliyunROSStackGroupExecutionRole to enable use of your account as a target account in Alibaba Cloud ROS StackGroup.
Conditions:
  CurrentAccount:
    Fn::Equals:
      - Ref: AdministrationAccount
      - ""
Parameters:
  AdministrationAccount:
    Default: ""
    Description: Administration account. If not, authorize the current account
    Type: String
  ExecutionRoleName:
    Default: AliyunROSStackGroupExecutionRole
    Description: Execution role name of target account
    Type: String
Resources:
  AliyunROSStackGroupExecutionRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              RAM:
                - Fn::Join:
                    - ""
                    - - "acs:ram::"
                      - Fn::If:
                          - CurrentAccount
                          - Ref: ALIYUN::TenantId
                          - Ref: AdministrationAccount
                      - :root
        Version: 1
      RoleName:
        Ref: ExecutionRoleName
    Type: ALIYUN::RAM::Role
  AttachPolicy:
    Properties:
      PolicyName: AdministratorAccess
      PolicyType: System
      RoleName:
        Fn::GetAtt:
          - AliyunROSStackGroupExecutionRole
          - RoleName
    Type: ALIYUN::RAM::AttachPolicyToRole
Outputs:
  ExecutionRoleName:
    Value:
      Fn::GetAtt:
        - AliyunROSStackGroupExecutionRole
        - RoleName
